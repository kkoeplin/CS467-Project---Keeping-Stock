<!-- https://htmx.org/examples/active-search/ -->
 
{% extends "base.html" %}

{% block title %}Find My Stuff{% endblock %}

{% block head %}
<!-- CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='gallery.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">

<!-- JS libraries -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js" defer></script>

<!-- Custom JS -->
<script src="{{ url_for('static', filename='initSelect2.js') }}" defer></script>
<script src="{{ url_for('static', filename='toggleItemTag.js') }}" defer></script>
<script type="module" src="{{ url_for('static', filename='showItemModal.js') }}" defer></script>
{% endblock %}

{% block content %}
<h1>Find My Stuff</h1>

<div id="search-form">
    <!--
        The following actions (hx-trigger) will trigger the GET request (hx-get):
        - typing in the search bar
        - clicking on the cross in the search bar
        - selecting a box from the dropdown
        - clicking on an item tag 
    -->
    <form
        hx-get="{{ url_for('gallery.filtered_view') }}"
        hx-target="#gallery-items"    
        hx-push-url="true"
        hx-sync="this:replace"
        hx-trigger="
            keyup throttle:300ms from:input,
            search from:input[type='search'] queue:none,
            change from:select queue:none,
            change from:input[name='tags'] queue:none
        "
    >

        <!-- search bar for items -->
        <input id="search-bar" type="search" name="search" placeholder="Search" value="{{ default_search }}"/>

        <!-- dropdown to select boxes -->
        <select id="select-dropdown" name="box">
            <option value="" {% if default_box_id == '' %}selected{% endif %}>All Boxes</option>
            {% for box_id, desc in all_boxes.items() %}
                <option value="{{ box_id }}" {% if default_box_id == box_id %}selected{% endif %}>{{ desc }}</option>
            {% endfor %}
        </select>

        <!-- toggles for item tags -->
        <div id="tags">
            {% for t in all_tags %}
                <label class="tag {% if t in checked_tags %}is-checked{% endif %}">
                    <input
                        type="checkbox"
                        class="tag-checkbox"
                        name="tags"
                        value="{{ t }}"
                    >
                    <span>{{ t }}</span>
                </label>
            {% endfor %}
        </div>
    </form>

    <!-- displaying items retrieved from MongoDB -->
    <p id="item-card-hint"><small>Click an item card to view more details.</small></p>
    <div id="gallery-items">
        {% include "gallery_items.html" %}
    </div>
</div>
{% endblock %}
